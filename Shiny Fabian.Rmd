---
title: "Shiny Fabian"
output: html_document
date: "2024-03-14"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Pakete
Benötigte Pakete aufrufen
```{r}
library(shiny)
library(leaflet)
library(leaflet.extras)
```

#UI 

Hier wird das User-Interface erstellt 
```{r}

ui <- fluidPage(
  titlePanel("Analyse - Fehlerhafte Bauteile"),
  theme = "steelblue",
  tabsetPanel(type = "tabs",
              tabPanel("Heatmap", leafletOutput(
                "map"
              )),
              tabPanel("Produktionsmenge", fluidRow()),
              tabPanel("Suche - Fahrzeug",fluidRow(
                  sidebarLayout(
                  sidebarPanel(
                    textInput("suche_id", "Suche Fahrzeug ID:"),
                    actionButton("checkButton","Suche")
                  ),
                  
                  mainPanel(
                    textOutput("defect_message")
                  )
                )
              )),
              tabPanel("Vergleiche Nutzungsdauer", fluidRow())
              
              )
  
  
  
)

```



#Server
Die App mit Inhalt füllen 
```{r}

server <- function(input,output,session){
  output$map <- renderLeaflet({
    leaflet() %>%
      addTiles() %>%  # Fügt OpenStreetMap-Kacheln hinzu
      setView(lng = 10.4515, lat = 51.1657, zoom = 6)  # Zentriert die Karte auf Deutschland
  })
  
  #Erstellung Heatmap

    observe({
      leafletProxy("map", data = Gemeinde_Fehler_Häufigkeit) %>%
        addHeatmap(
          lng = ~Laengengrad,  # Längengrade aus dem DataFrame
          lat = ~Breitengrad,  # Breitengrade aus dem DataFrame
          intensity = ~Anzahl_Fehler,  # Intensität basierend auf der Anzahl der Fehler
          blur = 20,  # Weichzeichner-Effekt
          max = 5,  # Maximale Intensität
          radius = 10  # Radius der Heatmap-Punkte
        )
    })

  
  
  #Reactive expression to check if the entered ID is defective
  output$defect_message <- renderText({
    
    #Button eingebaut bevor nach ID gesucht wird
    input$checkButton
    
    id <- isolate(input$suche_id)
    
    if (id %in% Große_Datenbank$ID_Fahrzeug) {
      return("Ihr Fahrzeug ist defekt.")
    }else{
      return("Ihr Fahrzeug ist nicht defekt!")
    } 
  })
  
  
}


```

#Ausführung
```{r}

shinyApp(ui = ui, server = server)


```
